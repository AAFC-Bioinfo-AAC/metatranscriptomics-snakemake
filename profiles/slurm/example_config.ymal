## For Snakemake to recognize this file it must be named config.yaml.
## Specific information to our HPC configuration has been replaced in this example with CAPITAL LETTERS
## Please edit to include the configuration of the cluster you are using

### How Snakemake will run on SBATCH ###
cores: 60
jobs: 10 
latency-wait: 60 
rerun-incomplete: true
retries: 2              
max-jobs-per-second: 2 
executor: slurm

# Prevent rerunning jobs just for Snakefile edits
## flags available [input, mtime, params, software-env, code, resources, none]
rerun-triggers: [input, params, software-env]

### Env Vars ###
envvars:
  TMPDIR: "PATH/TO/scratch/${USER}/tmpdir"

default-resources:
  - slurm_account=ACCOUNT
  - slurm_partition=standard
  - slurm_cluster=GPSC
  - slurm_qos=low    #If jobs are held in queue for long.
  - runtime=60       # minutes
  - mem_mb=4000

### Env modules ###
# use-envmodules: false 

### Conda ###
use-conda: true
conda-frontend: mamba   

### Resource scopes ###
set-resource-scopes:
  cores: local 

# Reusable Slurm Blocks (anchors)
# Standard partition/account/cluster used by most rules
_slurm_std: &slurm_std
  slurm_partition: standard
  slurm_account: ACCOUNT
  slurm_cluster: CLUSTER

# Large memory partition/account/cluster used by some rules
_slurm_large: &slurm_large
  slurm_partition: large
  slurm_account: ACCOUNT__large
  slurm_cluster: CLUSTER

## Per rule resources
set-resources:
  fastp_pe:
    <<: *slurm_std
    mem_mb: 4000
    runtime: 40

  bowtie2_align:
    <<: *slurm_std
    mem_mb: 48000
    runtime: 30

  extract_unmapped_fastq:
    <<: *slurm_std
    mem_mb: 64000
    runtime: 30

  sortmerna_pe:
    <<: *slurm_std
    mem_mb: 32000
    runtime: 360

  kraken2:
    <<: *slurm_large
    mem_mb: 600000
    runtime: 30

  bracken:
    <<: *slurm_std
    mem_mb: 4000
    runtime: 10

  combine_bracken_outputs:
    <<: *slurm_std
    mem_mb: 2000
    runtime: 20

  bracken_extract:
    <<: *slurm_std
    mem_mb: 2000
    runtime: 10

  rgi_reload_database:
    <<: *slurm_std
    mem_mb: 2000
    runtime: 30

  rgi_bwt:
    <<: *slurm_std
    mem_mb: 64000
    runtime: 60

  rna_spades:
    <<: *slurm_std
    mem_mb: 64000
    runtime: 240

  rnaquast_busco:
    <<: *slurm_std
    mem_mb: 16000
    runtime: 10

  megahit_coassembly:
    <<: *slurm_std
    mem_mb: 256000
    runtime: 240

  index_coassembly:
    <<: *slurm_std
    mem_mb: 16000
    runtime: 120

  bowtie2_map_transcripts:
    <<: *slurm_std
    mem_mb: 32000
    runtime: 30

  assembly_stats_depth:
    <<: *slurm_std
    mem_mb: 2000
    runtime: 30

  prodigal_genes:
    <<: *slurm_std
    mem_mb: 2000
    runtime: 60

  featurecounts:
    <<: *slurm_std
    mem_mb: 8000
    runtime: 10